#!/usr/bin/env bash
set -e

cd "$(dirname "$0")/.."

VERSION=$(ruby -r./lib/opentelemetry/instrumentation/servactory/version -e "puts OpenTelemetry::Instrumentation::Servactory::VERSION::STRING")
GEM_NAME="opentelemetry-instrumentation-servactory"
GEM_FILE="gems/${GEM_NAME}-${VERSION}.gem"

mkdir -p gems

echo "Building ${GEM_NAME} v${VERSION}..."
gem build ${GEM_NAME}.gemspec -o "$GEM_FILE"

read -p "Enter OTP: " OTP
gem push "$GEM_FILE" --otp="$OTP"

echo "Released ${GEM_NAME} v${VERSION}"
